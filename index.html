<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Monitoreo â€“ Salidas Dulces</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <style>
  body{
    font-family:'Poppins',sans-serif;
    margin:0; padding:12px;
    min-height:100vh;
    background: linear-gradient(to right,#00416A,#E4E5E6);
    position: relative;
  }
  /* ðŸ”¹ Marca de agua general en el fondo */
  body::before{
    content:"";
    position: fixed;
    top:50%; left:50%;
    transform: translate(-50%,-50%);
    width: clamp(500px, 60vw, 1000px);  /* tamaÃ±o flexible */
    height: auto;
    background: url('logo_proveedora.webp') no-repeat center center;
    background-size: contain;
    opacity: 0.08;      /* transparencia ðŸ‘ˆ ajusta entre 0.05 y 0.12 */
    z-index: 0;
    pointer-events: none; /* no bloquea clics */
  }

  h1{ 
    text-align:center; 
    color:white; 
    margin:10px 0; 
    position: relative;
    z-index: 1; 
  }
  .tarjeta{
    background: rgba(255,255,255,0.88); /* ðŸ‘ˆ blanco con transparencia */
    border-radius:10px; 
    padding:10px 14px; 
    box-shadow:0 2px 5px rgba(0,0,0,0.15);
    margin-bottom:12px;
    font-size:13px;
    position: relative;
    z-index: 1; /* para estar arriba del fondo */
  }
  .tarjeta h2{ margin:0; font-size:15px; color:#00416A }
  .productos{ width:100%; border-collapse:collapse; margin-top:6px; font-size:12px }
  .productos th, .productos td{
    border:1px solid #ccc; padding:4px; text-align:center;
  }
  .productos th{ background:#00416A; color:white; font-size:12px }
  .firmas{ display:flex; justify-content:space-between; margin-top:8px; gap:8px }
  .firma-box{ text-align:center; flex:1 }
  .firma-box img{ max-width:120px; max-height:60px; border:1px solid #ccc }
  .btn-imprimir{
    margin-top:8px; padding:5px 10px; border:none;
    background:#0c6cbd; color:white; border-radius:6px;
    cursor:pointer; font-size:12px;
  }
  @media print {
    body{ background:white; }
    .btn-imprimir{ display:none }
    body::before{ display:none } /* ðŸ”¹ ocultar marca de agua al imprimir */
  }
  </style>
</head>
<body>
  <h1>Monitoreo de Salidas â€“ AlmacÃ©n Dulces</h1>
  <div id="contenedor"></div>

  <!-- Firebase -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getFirestore, collection, query, orderBy, onSnapshot } 
      from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    // Configura tu Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyCK5nb6u2CGRJ8AB1aPlRn54b97bdeAFeM",
      authDomain: "inventariopv-643f1.firebaseapp.com",
      projectId: "inventariopv-643f1",
      storageBucket: "inventariopv-643f1.appspot.com",
      messagingSenderId: "96242533231",
      appId: "1:96242533231:web:aae75a18fbaf9840529e9a"
    };
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const contenedor = document.getElementById("contenedor");

    // ðŸ”¥ Monitoreo en tiempo real
    function cargarSalidasTiempoReal(){
      const q = query(
        collection(db,"almacenes/Almacen_Dulces/salidas"),
        orderBy("folio","desc")
      );

      onSnapshot(q, (snapshot)=>{
        contenedor.innerHTML = ""; // limpiar antes de volver a dibujar
        snapshot.forEach(doc=>{
          const data = doc.data();

          const div = document.createElement("div");
          div.className="tarjeta";
          div.innerHTML=`
            <h2>Folio: ${data.folio || ""} â€“ ${data.fecha || ""}</h2>
            <p><b>Destino:</b> ${data.destino || ""}</p>
            <p><b>Entrega:</b> ${data.entrega || ""} | <b>Recibe:</b> ${data.recibe || ""}</p>
            <table class="productos">
              <thead><tr><th>CÃ³digo</th><th>Producto</th><th>Cantidad</th></tr></thead>
              <tbody>
                ${(data.productos || []).map(p=>`
                  <tr><td>${p.codigo}</td><td>${p.descripcion}</td><td>${p.cantidad}</td></tr>
                `).join("")}
              </tbody>
            </table>
            <div class="firmas">
              <div class="firma-box">
                <p>Firma Entrega</p>
                ${data.firmaEntrega ? `<img src="${data.firmaEntrega}">` : "â€”"}
              </div>
              <div class="firma-box">
                <p>Firma Recibe</p>
                ${data.firmaRecibe ? `<img src="${data.firmaRecibe}">` : "â€”"}
              </div>
            </div>
            <button class="btn-imprimir" onclick="imprimirTarjeta(this)">ðŸ–¨ Imprimir</button>
          `;
          contenedor.appendChild(div);
        });
      });
    }
    cargarSalidasTiempoReal();

    // FunciÃ³n para imprimir solo la tarjeta seleccionada
    window.imprimirTarjeta=function(btn){
      const tarjeta=btn.parentElement.innerHTML;
      const w=window.open("","","width=800,height=600");
      w.document.write(`<html><head><title>Imprimir</title></head><body>${tarjeta}</body></html>`);
      w.document.close();
      w.print();
    }
  </script>
</body>
</html>
